<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<#include "/header-smart.html" />
<body>
<section id="widget-grid">
	<!-- row -->
	<div class="row">
		<article class="col-sm-12 col-md-12 col-lg-12">
			<div class="jarviswidget" id="wid-id-5" data-widget-collapsed="false" data-widget-hidden="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-grid="" data-widget-sortable="false" data-widget-editbutton="false" data-widget-fullscreenbutton="false">
				<header role="heading">
					<ul class="nav nav-tabs pull-left in">
						<li class="active">
							<a data-toggle="tab" class="tabs" href="#tab-gold" aria-expanded="false"><span class="hidden-mobile hidden-tablet"> 素金 </span> </a>
						</li>
						<li>
							<a data-toggle="tab" class="tabs" href="#tab-notGold" aria-expanded="true"><span class="hidden-mobile hidden-tablet"> 非素 </span> </a>
						</li>
						<li>
							<a data-toggle="tab" class="tabs" href="#tab-material" aria-expanded="true"><span class="hidden-mobile hidden-tablet"> 旧料 </span> </a>
						</li>
						<li>
							<a data-toggle="tab" class="tabs" href="#tab-serviceFee" aria-expanded="true"><span class="hidden-mobile hidden-tablet"> 服务费 </span> </a>
						</li>
					</ul>
				</header>
				<div>
					<div class="widget-body">
						<div class="widget-body-toolbar">
							<div class="row">
								<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
									<div class="input-group">
										<span class="input-group-addon"><i class="fa fa-search"></i></span>
										<input class="form-control" id="prepend" placeholder="请输入过滤条件" type="text">
									</div>
								</div>
								<div class="col-xs-9 col-sm-9 col-md-9 col-lg-9 text-right">
									<a href="javascript:void(0);" id="addBtn" class="btn btn-sm btn-primary"><i class="fa fa-plus"></i>添加</a>
								</div>
							</div>
						</div>
						<div class="tab-content">
							<div class="tab-pane active" id="tab-gold">
								<table id="jqgrid" class="table table-bordered table-hover table-striped"></table>
								<div id="pjqgrid"></div>
							</div>
							<div class="tab-pane" id=tab-notGold>
								<table id="jqgrid2" class="table table-bordered table-hover table-striped "></table>
							</div>
							<div class="tab-pane" id="tab-material">
								<table id="jqgrid3" class="table table-bordered table-hover table-striped"></table>
							</div>
							<div class="tab-pane" id="tab-serviceFee">
								<table id="jqgrid4" class="table table-bordered table-hover table-striped"></table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</article>
	</div>
</section>
</body>
<script src="static/js/libs/jquery-3.2.1.min.js"></script>
<script src="static/js/app.config.js"></script>
<script src="static/js/bootstrap/bootstrap.min.js"></script>
<script src="static/js/smartwidgets/jarvis.widget.min.js"></script>
<script src="static/js/app.js?v=1"></script>
<script src="resource/layui/layui.all.js?v=1" charset="utf-8"></script>
<script src="static/js/plugin/jqgrid/jquery.jqGrid.min.js?v=33" charset="utf-8"></script>
<script src="static/js/plugin/jqgrid/grid.locale-cn.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		pageSetUp();

		jQuery("#jqgrid").jqGrid({
			url : 'sysGoodsCategory/getGoodsCategoryData.do?firstType=gold',
			datatype : "json",
	        colNames : ['操作','系统编码', '助记码', '商品名称', '商品小类','销售方式','兑换', '金料', '石料', '品名' ,  '统计大类' , '统计中类', '统计小类', '标签模板', '状态' ],
	        colModel : [ 
						 {name : 'opera',sortable:false}, 
	                     {name : 'systemCode'}, 
	                     {name : 'assistCode'}, 
	                     {name : 'goodsName'},
		                 {name : 'secondTypeName'},
	                     {name : 'saleType'}, 
	                     {name : 'canBarter',formatter:function(cellValue, options, rowObject){
	                    	 if(cellValue == 1){
	                    		 return "可兑换";
	                    	 }else{
	                    		 return "不可兑换";
	                    	 }
	                     }}, 
	                     {name : 'goldName'},
	                     {name : 'jewelName'},
	                     {name : 'categoryName'},
	                     {name : 'firstClassify'},
	                     {name : 'secondClassify'},
	                     {name : 'thirdClassify'},
	                     {name : 'grfName'},
	                     {name : 'status',formatter:function(cellValue, options, rowObject){
	                    	 if(cellValue == 1){
	                    		 return "在用";
	                    	 }else{
	                    		 return "禁用";
	                    	 }
	                     }}
	                   ],
			caption : "商品分类详情",
			rowNum: -1,
			gridComplete: function(){
				var ids = jQuery("#jqgrid").jqGrid('getDataIDs');
				for(var i=0;i < ids.length;i++){
					var cl = ids[i];
					be = "<button class='btn btn-xs btn-default' data-original-title='Edit Row' onclick=\"editCategory('"+cl+"');\"><i class='fa fa-pencil'></i></button>"; 
					ca = "<button class='btn btn-xs btn-default' data-original-title='Cancel' onclick=\"deleteCategory('"+cl+"');\"><i class='fa fa-times'></i></button>";  
					jQuery("#jqgrid").jqGrid('setRowData',ids[i],{opera:be+ca});
				}	
			},
			multiselect : true,
	        pager : '#pjqgrid',
	        viewrecords : true,
	        loadonce : true,
			autowidth : true,
			pgbuttons:false,
			pgtext:false,
			rownumbers:false,
			ondblClickRow : function(rowid) { // 双击行
				editCategory(rowid);
			},
			recordtext:"共{1}记录"
		}).navGrid('#pjqgrid',{edit:false,add:false,del:false,search:true,refresh:false}).navButtonAdd('#pjqgrid',{  
			   buttonicon:"ui-icon-trash",   
			   caption:"",
			   title:"删除所选记录",
			   onClickButton: function(){
				   var ids = jQuery("#jqgrid").jqGrid('getGridParam', 'selarrrow');
				   if(ids != null && ids.length >0){
					   layer.confirm("确认删除所选行吗？",function(index){
						   deleteCategory(ids);
						   layer.close(index);
					   })
				   }
			   },   
			   position:"first"  
			}).navButtonAdd('#pjqgrid',{  
				   buttonicon:"ui-icon-plus",   
				   caption:"",
				   title:"新增记录",
				   onClickButton: function(){
					   editCategory(null);
				   },   
				   position:"first"
			}).navButtonAdd('#pjqgrid',{  
				   buttonicon:"ui-icon-refresh",   
				   caption:"",
				   title:"刷新",
				   onClickButton: function(){
					   jQuery("#jqgrid").setGridParam({datatype:'json'}).trigger('reloadGrid');
				   },   
				   position:"first"
				});
		
		jQuery("#jqgrid").jqGrid( 'setGridHeight', $(window).height() - 300 );
		
		
		// remove classes
		$(".ui-jqgrid").removeClass("ui-widget ui-widget-content");
	    $(".ui-jqgrid-view").children().removeClass("ui-widget-header ui-state-default");
	    $(".ui-jqgrid-labels, .ui-search-toolbar").children().removeClass("ui-state-default ui-th-column ui-th-ltr");
	    $(".ui-jqgrid-pager").removeClass("ui-state-default");
	    $(".ui-jqgrid").removeClass("ui-widget-content");
	   
	   
	    $(".ui-pg-div").removeClass().addClass("btn btn-sm btn-primary");
	    $(".ui-icon.ui-icon-plus").removeClass().addClass("fa fa-plus");
	    $(".ui-icon.ui-icon-pencil").removeClass().addClass("fa fa-pencil");
	    $(".ui-icon.ui-icon-trash").removeClass().addClass("fa fa-trash-o");
	    $(".ui-icon.ui-icon-search").removeClass().addClass("fa fa-search");
	    $(".ui-icon.ui-icon-refresh").removeClass().addClass("fa fa-refresh");
	    $(".ui-icon.ui-icon-disk").removeClass().addClass("fa fa-save").parent(".btn-primary").removeClass("btn-primary").addClass("btn-success");
	    $(".ui-icon.ui-icon-cancel").removeClass().addClass("fa fa-times").parent(".btn-primary").removeClass("btn-primary").addClass("btn-danger");
	  
	    
		$("#addBtn").on("click",function(){
			editCategory(null);
		})
	});
	
	function editCategory(id){
		var url="sysGoodsCategory/editGoodsCategory.do";
		if(id != null){
			url+="?id="+id;
		}
		layer.open({
			type : 2,
			title : "新增/修改商品分类",
			area : ['900px','375px'],
			shade : 0.8,
			id : 'lay_addCategory', //设定一个id，防止重复弹出
			btn : [ '保存', '取消' ],
			moveType : 1, //拖拽模式，0或者1
			content : url,
			yes : function(index, layero) {
				 $(layero).find("iframe")[0].contentWindow.submitData();
				 jQuery("#jqgrid").setGridParam({datatype:'json'}).trigger('reloadGrid');
			}
		});
	}
	
	function deleteCategory(ids){
		if(ids==null){
			return;
		}else{
			$.ajax({
		        type: "POST",
		        url: "sysGoodsCategory/deleteCategory.do?ids="+ids,
		        dataType: 'json',
		        async: false,
		        success: function(data) {
		            if (data.status == '100') {
		            	jQuery("#jqgrid").setGridParam({datatype:'json'}).trigger('reloadGrid');
		            	layer.msg("删除成功");
		            }else{
		            	layer.msg("删除失败");
		            }
		        },
		        error: function() {
		        	layer.alert("连接服务器失败，请稍后重试");
		        }
		    });
		}
	}
</script>
</html>