<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<#include "/header-smart.html" />
<body >
	<div class="well no-margin">
		<form id="categoryForm">
			<div class="row form-body form-horizontal">
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-sm-4 control-label">系统编码：</label>
						<div class="col-lg-8 col-sm-8">
							<input type="hidden" id="id" name="id" class="form-control" value="${catetory.id}">
							<input type="text" id="systemCode" name="systemCode" class="form-control" value="${catetory.systemCode}">
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label
							class="col-lg-4 col-md-4 col-sm-4 control-label">商品大类：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<select id="firstType" name="firstType" class="form-control" data-live-search="true">
								<option value="gold">素金</option>
								<option value="notGold">非素</option>
								<option value="material">旧料</option>
								<option value="serviceFee">服务费</option>
							</select>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-sm-4 control-label">商品小类：</label>
						<div class="col-lg-8 col-sm-8">
							<select id="secondType" name="secondType" class="form-control" data-live-search="true">
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="row form-body form-horizontal">
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label
							class="col-lg-4 col-md-4 col-sm-4 control-label">金料名：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<select id="goldName" name="goldName" multiple="multiple" class="form-control selectpicker show-tick" data-live-search="true">
							</select>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">石料名：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<select id="jewelName" name="jewelName" multiple="multiple" class="form-control selectpicker show-tick" data-live-search="true">
							</select>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-sm-4 control-label">品名：</label>
						<div class="col-lg-8 col-sm-8">
							<select id="categoryName" name="categoryName" multiple="multiple" class="form-control selectpicker show-tick" data-live-search="true">
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="row form-body form-horizontal">
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">含金量：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<select id="goldPercent" name="goldPercent" multiple="multiple" class="form-control selectpicker show-tick" data-live-search="true">
							</select>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">商品名称：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<input type="text" id="goodsName" name="goodsName" class="form-control" value="${catetory.goodsName}">
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-sm-4 control-label">缩写：</label>
						<div class="col-lg-8 col-sm-8">
							<input type="text" id="assistCode" name="assistCode" class="form-control" value="${catetory.assistCode}">
						</div>
					</div>
				</div>
			</div>
			<div class="row form-body form-horizontal">
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">统计大类：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<select id="firstClassify" name="firstClassify" class="form-control">
							</select>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">统计中类：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<select id="secondClassify" name="secondClassify" class="form-control">
							</select>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-sm-4 control-label">统计小类：</label>
						<div class="col-lg-8 col-sm-8">
							<select id="thirdClassify" name="thirdClassify" class="form-control">
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="row form-body form-horizontal">
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">销售方式：</label>
						<div class="col-lg-8 col-sm-8">
							<select id="saleType" name="saleType" class="form-control">
								<option value="1">折扣</option>
								<option value="2">金价</option>
								<option value="3">折扣+金价</option>
							</select>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">标签名称：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<input type="text" id="labelName" name="labelName" class="form-control" value="${catetory.labelName}">
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">标签模板：</label>
						<div class="col-lg-8 col-md-8 col-sm-8">
							<select id="labelTpl" name="labelTpl" class="form-control">
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="row form-body form-horizontal">
				<div class="col-lg-4 col-md-4 col-sm-4 no-padding">
					<div class="form-group margin-bottom-5 margin-right-5">
						<label class="col-lg-4 col-md-4 col-sm-4 control-label">备注：</label>
						<div class="col-lg-8 col-sm-8">
							<input type="text" id="remark" name="remark" class="form-control" value="${catetory.remark}">
						</div>
					</div>
				</div>
				<div class="col-lg-6 col-md-6 col-sm-6">
					<div class="form-group pull-right">
						<label class="checkbox-inline"> 
							<input type="checkbox" class="checkbox"> <span>名称自动生成</span>
						</label> 
						<label class="checkbox-inline"> 
							<input type="checkbox" id="canBarter" name="canBarter"<#if "${catetory.canBarter == 1}">checked</#if>  class="checkbox" value="1"> <span>可兑换</span>
						</label> 
						<label class="checkbox-inline" style="height: 28px;"> 
							<span class="onoffswitch">
							<input type="checkbox" id="status" name="status" <#if "${catetory.status == 1}">checked</#if> value="1" class="onoffswitch-checkbox">
							<label class="onoffswitch-label" for="status"> 
								<span class="onoffswitch-inner" data-swchon-text="启用" data-swchoff-text="停用"></span> 
								<span class="onoffswitch-switch"></span>
							</label>
							</span>
							<span>状态</span> 
						</label>
					</div>
				</div>
			</div>
		</form>
	</div>
</body>
<script src="static/js/libs/jquery-3.2.1.min.js"></script>
<script src="static/js/app.config.js"></script>
<script src="static/js/bootstrap/bootstrap.min.js"></script>
<script src="static/js/smartwidgets/jarvis.widget.min.js"></script>
<script src="static/js/app.js?v=1"></script>
<script src="static/plugins/bootstrap-select/js/bootstrap-select.js"></script>
<script src="static/plugins/bootstrap-select/js/i18n/defaults-zh_CN.min.js"></script>
<script src="resource/layui/layui.all.js?v=1" ></script>
<script type="text/javascript">
	$(document).ready(function() {
		pageSetUp();
		var elements=loadElements();
		$("#firstType").on("change",function(){
			$("#secondType").html("");
			var mainType = $(this).val();
			var list=[];
			if(mainType == "gold"){
				list = elements.secondType.gold;
			}else if(mainType == 'notGold'){
				list = elements.secondType.notGold;
			}else if(mainType == 'material'){
				list = elements.secondType.material;
			}else if(mainType == 'serviceFee'){
				list = elements.secondType.serviceFee;
			}
			var html="";
			for(var i=0;i<list.length;i++){
				html+="<option value='"+list[i].secondType+"'>"+list[i].secondTypeName+"</option>";
			}
			$("#secondType").html(html)
			$('#goldName').prop('disabled', false);
			$("#goldName").selectpicker('refresh');
			$('#jewelName').prop('disabled', false);
			$("#jewelName").selectpicker('refresh');
			$('#categoryName').prop('disabled', false);
			$("#categoryName").selectpicker('refresh');
			$('#goldPercent').prop('disabled', false);
			$("#goldPercent").selectpicker('refresh');
			//设置金石品的属性
			if(mainType == 'gold'){
				var html="";
				for(var i=0;i<elements.goldName.length;i++){
					html+="<option value='"+elements.goldName[i]+"'>"+elements.goldName[i]+"</option>";
				}
				$("#goldName").html(html)
				$("#goldName").selectpicker('refresh');
				
				var html="";
				for(var i=0;i<elements.jewelName.length;i++){
					html+="<option value='"+elements.jewelName[i]+"'>"+elements.jewelName[i]+"</option>";
				}
				$("#jewelName").html(html)
				$("#jewelName").selectpicker('refresh');
				
				var html="";
				for(var i=0;i<elements.categoryName.length;i++){
					html+="<option value='"+elements.categoryName[i]+"'>"+elements.categoryName[i]+"</option>";
				}
				$("#categoryName").html(html)
				$("#categoryName").selectpicker('refresh');
				
				var html="";
				for(var i=0;i<elements.goldPercent.length;i++){
					html+="<option value='"+elements.goldPercent[i]+"'>"+elements.goldPercent[i]+"</option>";
				}
				$("#goldPercent").html(html)
				$("#goldPercent").selectpicker('refresh');
			}else if(mainType == 'notGold'){
				var html="";
				for(var i=0;i<elements.goldName.length;i++){
					html+="<option value='"+elements.goldName[i]+"'>"+elements.goldName[i]+"</option>";
				}
				$("#goldName").html(html)
				$("#goldName").selectpicker('refresh');
				
				var html="";
				for(var i=0;i<elements.jewelName.length;i++){
					html+="<option value='"+elements.jewelName[i]+"'>"+elements.jewelName[i]+"</option>";
				}
				$("#jewelName").html(html)
				$("#jewelName").selectpicker('refresh');
				
				var html="";
				for(var i=0;i<elements.categoryName.length;i++){
					html+="<option value='"+elements.categoryName[i]+"'>"+elements.categoryName[i]+"</option>";
				}
				$("#categoryName").html(html)
				$("#categoryName").selectpicker('refresh');
				
				var html="";
				for(var i=0;i<elements.goldPercent.length;i++){
					html+="<option value='"+elements.goldPercent[i]+"'>"+elements.goldPercent[i]+"</option>";
				}
				$("#goldPercent").html(html)
				$("#goldPercent").selectpicker('refresh');
			}else if(mainType =='material'){
				var html="";
				$("#jewelName").html(html)
				$('#jewelName').prop('disabled', true);
				$("#jewelName").selectpicker('refresh');
				$("#categoryName").html(html)
				$('#categoryName').prop('disabled', true);
				$("#categoryName").selectpicker('refresh');
				$("#goldPercent").html(html)
				$('#goldPercent').prop('disabled', true);
				$("#goldPercent").selectpicker('refresh');
				for(var i=0;i<elements.goldName.length;i++){
					html+="<option value='"+elements.goldName[i]+"'>"+elements.goldName[i]+"</option>";
				}
				$("#goldName").html(html)
				$("#goldName").selectpicker('refresh');
			}else  if(mainType == 'serviceFee'){
				var html="";
				$("#goldName").html(html)
				$('#goldName').prop('disabled', true);
				$("#goldName").selectpicker('refresh');
				$("#jewelName").html(html)
				$('#jewelName').prop('disabled', true);
				$("#jewelName").selectpicker('refresh');
				$("#categoryName").html(html)
				$('#categoryName').prop('disabled', true);
				$("#categoryName").selectpicker('refresh');
				$("#goldPercent").html(html)
				$('#goldPercent').prop('disabled', true);
				$("#goldPercent").selectpicker('refresh');
			}
			var html="";
			for(var i=0;i<elements.labelTpl.length;i++){
				html+="<option value='"+elements.labelTpl[i]+"'>"+elements.labelTpl[i]+"</option>";
			}
			$("#labelTpl").html(html)
			for(var i=0;i<elements.firstClassify.length;i++){
				html+="<option value='"+elements.firstClassify[i]+"'>"+elements.firstClassify[i]+"</option>";
			}
			$("#firstClassify").html(html)
			
			var html="";
			for(var i=0;i<elements.secondClassify.length;i++){
				html+="<option value='"+elements.secondClassify[i]+"'>"+elements.secondClassify[i]+"</option>";
			}
			$("#secondClassify").html(html)
			
			var html="";
			for(var i=0;i<elements.thirdClassify.length;i++){
				html+="<option value='"+elements.thirdClassify[i]+"'>"+elements.thirdClassify[i]+"</option>";
			}
			$("#thirdClassify").html(html)
		})
		
		$("#secondType").on("change",function(){
			var val = $(this).val();
			var mainType = $("#firstType").val();
			var list=[];
			if(mainType == "gold"){
				list = elements.secondType.gold;
			}else if(mainType == 'notGold'){
				list = elements.secondType.notGold;
			}else if(mainType == 'material'){
				list = elements.secondType.material;
			}else if(mainType == 'serviceFee'){
				list = elements.secondType.serviceFee;
			}
			var html="";
			for(var i=0;i<list.length;i++){
				if(list[i].secondType == val){
					$("#saleType").val(list[i].saleType);
					$("#canBarter").attr("checked",(list[i].canBarter == 1?true:false));
					break;
				}
			}
		})
		
		$("#firstType").change();
		//初始化页面select
		initSelect();
	});
	
	function initSelect(){
		$('#firstType').val('${catetory.firstType}');
		$("#secondType").val('${catetory.secondType}');
		$("#goldName").selectpicker('val', '${catetory.goldName}');
		$("#jewelName").selectpicker('val', '${catetory.jewelName}');
		$("#categoryName").selectpicker('val', '${catetory.categoryName}');
		$("#goldPercent").selectpicker('val', '${catetory.goldPercent}');
		$("#firstClassify").val('${catetory.firstClassify}');
		$("#secondClassify").val('${catetory.secondClassify}');
		$("#thirdClassify").val('${catetory.thirdClassify}');
		$("#labelTpl").val('${catetory.labelTpl}');
		$("#saleType").val('${catetory.saleType}');
	}
	
	function loadElements(){
		var elements;
		$.ajax({
	        type: "POST",
	        url: "sysElement/getElements.do?elements=secondType,goldName,jewelName,categoryName,goldPercent,firstClassify,secondClassify,thirdClassify,labelTpl",
	        dataType: 'json',
	        async: false,
	        success: function(data) {
	            if (data.status == '100') {
	            	elements=data.data;
	            }else{
	            	layer.msg("加载商品小类失败");
	            }
	        },
	        error: function() {
	        	layer.alert("连接服务器失败，请稍后重试");
	        }
	    });
		return elements;
	}
	
	function submitData(){
		var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
		//提交 Ajax 成功后，关闭当前弹层并重载表格
		var param = $("#categoryForm").serialize();
		param+="&firstTypeName="+$("#firstType").find(":selected").html();
		param+="&secondTypeName="+$("#secondType").find(":selected").html();
		$.ajax({
	        type: "POST",
	        url: "sysGoodsCategory/saveGoodsCategory.do",
	        dataType: 'json',
	        async: false,
	        data: param,
	        success: function(data) {
	            if (data.status == '100') {
	            	layer.alert("保存成功");
	            	parent.layer.close(index); //再执行关闭 
	            }else{
	            	layer.alert("获取基础信息失败");
	            }
	        },
	        error: function() {
	        }
	    });
	}
</script>
</html>

