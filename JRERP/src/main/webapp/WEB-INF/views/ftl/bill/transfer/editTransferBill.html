<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"> 
<#include "/header-smart.html" />
<base href="${basePath}">
<link rel="stylesheet" href="static/plugins/webix/codebase/webix.css?v=6.0.7" type="text/css" charset="utf-8">
<link rel="stylesheet" href="static/plugins/webix/codebase/skins/mini.css" type="text/css" charset="utf-8">
<link rel="stylesheet" href="static/plugins/webix/querybuilder/querybuilder.css" type="text/css" charset="utf-8">
<link rel="stylesheet" href="static/plugins/webix/querybuilder/skins/compact.css" type="text/css" charset="utf-8">
<style>
    .myhover{
        background: #F4F5F9;
    }
     .header{
            background-color: #edf7fe;
        }
</style>
<body>
	<section id="widget-grid">
		<!-- row -->
		<div class="row no-margin">
			<article class="col-sm-12 col-md-12 col-lg-12">
				<div class="jarviswidget no-margin-top" id="wid-id-5"
					data-widget-colorbutton="false" data-widget-editbutton="false"
					data-widget-togglebutton="false" data-widget-deletebutton="false"
					data-widget-fullscreenbutton="false"
					data-widget-custombutton="false" data-widget-sortable="false">
					<div class="padding-top-5">
						<div class="widget-body">
							<div class="row">
								<div class="row margin-left-10">
									<div class="col-sm-6 col-md-6 col-lg-6">
										<ul class="demo-btns" style="height: 30px;">
											<li><a href="javascript:void(0);" class="btn btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 新增</a></li>
											<li><a id="saveAudit" href="javascript:void(0);" class="btn btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 保存</a></li>
											<li><a href="javascript:void(0);" id="activity" class="activity-dropdown btn  btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 未完成 <em class="badge bg-color-red">${desktopMap.totalNum}</em></a>
												<div class="ajax-dropdown">
													<div class="btn-group btn-group-justified" >
														<label class="btn btn-default active" data-id='noSave' onclick="showDropdown(this)">未完成(${desktopMap["noSave"]?size})</label>
														<label class="btn btn-default" data-id='waiting' onclick="showDropdown(this)">待审核 (${desktopMap["waiting"]?size})</label>
														<label class="btn btn-default" data-id='reject' onclick="showDropdown(this)">驳回 (${desktopMap["reject"]?size})</label>
													</div>
													<div class="ajax-notifications custom-scroll">
														<div class="alert alert-transparent no-margin no-padding">
															<ul id='noSave' class="notification-body">
																<#list desktopMap["noSave"] as tmp>
																<li>
																	<span class="unread">
																		<em class="badge padding-5 no-border-radius bg-color-yellow pull-left margin-right-5">
																			<i class="fa fa-edit fa-fw fa-2x"></i>
																		</em>
																		<span>
																			 ${tmp.billNo} <span class="text-primary">${tmp.totalNum}</span> and <span class="text-primary">kevin.reliey</span>
																			 <br>
																			 <span class="font-xs text-muted"><i>${tmp.billDate}</i></span>
																			 <button class="btn btn-xs btn-primary pull-right" onclick="continueEdit(${tmp.id})">编辑</button>
																		</span>
																	</span>
																</li>
																</#list>
															</ul>
															<ul id='waiting' class="notification-body" style="display: none;">
																<#list desktopMap["waiting"] as tmp>
																<li>
																	<span class="unread">
																		<em class="badge padding-5 no-border-radius bg-color-green pull-left margin-right-5">
																			<i class="fa fa-send fa-fw fa-2x"></i>
																		</em>
																		<span>
																			 ${tmp.billNo} <span class="text-primary">${tmp.totalNum}</span> and <span class="text-primary">kevin.reliey</span>
																			 <br>
																			 <span class="font-xs text-muted"><i>${tmp.billDate}</i></span>
																			 <button class="btn btn-xs btn-primary pull-right" onclick="continueEdit(${tmp.id})">查看</button>
																		</span>
																	</span>
																</li>
																</#list>
															</ul>
															<ul id='reject' class="notification-body" style="display: none;">
																<#list desktopMap["reject"] as tmp>
																<li>
																	<span class="unread">
																		<em class="badge padding-5 no-border-radius bg-color-red pull-left margin-right-5">
																			<i class="fa fa-warning fa-fw fa-2x"></i>
																		</em>
																		<span>
																			 ${tmp.billNo} <span class="text-primary">${tmp.totalNum}</span> and <span class="text-primary">kevin.reliey</span>
																			 <br>
																			 <span class="font-xs text-muted"><i>${tmp.billDate}</i></span>
																			 <button class="btn btn-xs btn-primary pull-right" onclick="continueEdit(${tmp.id})">查看</button>
																		</span>
																	</span>
																</li>
																</#list>
															</ul>																														
														</div>
													</div>
												</div>
											</li>
											<li><a href="javascript:void(0);" class="btn btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 打印</a></li>
											<li><a href="javascript:void(0);" class="btn btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 预览</a></li>
										</ul>
									</div>
								</div>
								<hr class="simple margin-5">
								<form id="billForm" class="form-horizontal" role="form">
									<input type="hidden" id="id" name="id" value="${billTransfer.id}">
									<input type="hidden" id="sysBillNo" name="sysBillNo" value="${billTransfer.sysBillNo}">
									<div class="row no-margin margin-bottom-5 padding-right-5">
										<div class="col-sm-3 col-md-3 col-lg-3 no-padding">
											<label class="col-md-4 col-sm-6 control-label">调出门店</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="areaCode" name="areaCode" data-validate="required" class="form-control selectpicker show-tick" title="请选择门店/部门" data-live-search="true">
													<#list areaList as p>
														<option value='${p.areaCode}' <#if p.areaType == 0>data-icon="fa fa-bank" data-subtext="总公司"</#if> <#if p.areaType == 1>data-icon="fa fa-cubes" data-subtext="区域"</#if> <#if p.areaType == 2>data-icon="fa fa-cab" data-subtext="门店"</#if> <#if p.areaCode == billPurchase.areaCode> selected </#if> >${p.areaName}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="col-sm-3 col-md-3 col-lg-3 no-padding">
											<label class="col-md-4 col-sm-6 control-label">调出柜台</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="counterAreaCode" name="counterAreaCode" data-validate="required" class="form-control selectpicker show-tick" title="请选择柜台" data-live-search="true">
												</select>
											</div>
										</div>
										<div class="col-sm-3 col-md-3 col-lg-3 no-padding">
											<label class="col-md-4 col-sm-6 control-label">调拨日期</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" class="form-control"  data-validate="required" id="billDate" name="billDate" value="${billTransfer.billDate}">
											</div>
										</div>
										<div class="col-sm-3 col-md-3 col-lg-3 no-padding">
											<label class="col-md-4 col-sm-6 control-label">调拨单号</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" class="form-control" id="billNo" name="billNo"  data-validate="required"  value="${billTransfer.billNo}" placeholder="请输入名字">
											</div>
										</div>										
									</div>
									<div class="row no-margin margin-bottom-5 padding-right-5">
										<div class="col-sm-3 col-md-3 col-lg-3 no-padding">
											<label class="col-md-4 col-sm-6 control-label">调入门店</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="inAreaCode" name="inAreaCode" data-validate="required" class="form-control selectpicker show-tick" title="请选择门店/部门" data-live-search="true">
													<#list areaList as p>
														<option value='${p.areaCode}' <#if p.areaType == 0>data-icon="fa fa-bank" data-subtext="总公司"</#if> <#if p.areaType == 1>data-icon="fa fa-cubes" data-subtext="区域"</#if> <#if p.areaType == 2>data-icon="fa fa-cab" data-subtext="门店"</#if> <#if p.areaCode == billPurchase.areaCode> selected </#if> >${p.areaName}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="col-sm-3 col-md-3 col-lg-3 no-padding">
											<label class="col-md-4 col-sm-6 control-label">调入柜台</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="inCounterAreaCode" name="inCounterAreaCode" data-validate="required" class="form-control selectpicker show-tick" title="请选择柜台" data-live-search="true">
												</select>
											</div>
										</div>
										<div class="col-sm-3 col-md-3 col-lg-3 no-padding">
											<label class="col-md-4 col-sm-6 control-label">备注</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" id="remarks" name="remarks" class="form-control"  placeholder="请输入名字" value="${billTransfer.remarks}" >
											</div>
										</div>
										<div class="col-sm-3 col-md-3 col-lg-3 no-padding">
											<label class="col-md-4 col-sm-6 control-label no-padding-top">
												<select id="searchType" class="form-control no-padding" title="请选择柜台" data-live-search="true">
													<option>条码号</option>
													<option>原条码</option>
													<option>证书号</option>
												</select>
											</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<div class="input-group">
													<input type="text" class="form-control">
													<div class="input-group-btn">
														<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" tabindex="-1">导入 <i class="fa fa-angle-down"></i></button>
														<ul class="dropdown-menu pull-right" role="menu">
															<li><a href="javascript:void(0);">按柜台导入</a></li>
															<li><a href="javascript:void(0);">按入库单导入</a></li>
															<li><a href="javascript:void(0);" onclick="showQueryBuilder()">按条件导入</a></li>
															<li class="divider"></li>
															<li><a href="javascript:void(0);">按输入导入</a></li>
														</ul>
													</div>
												</div>
											</div>
										</div>
									</div>
								</form>
							</div>
							<div id="testA"></div>
						</div>
					</div>
				</div>
			</article>
		</div>
	</section>
</body>
<script src="static/js/libs/jquery-3.2.1.min.js"></script>
<script src="static/js/app.config.js"></script>
<script src="static/js/bootstrap/bootstrap.min.js"></script>
<script src="static/js/smartwidgets/jarvis.widget.min.js"></script>
<script src="static/js/app.js?v=3"></script>
<script src="static/plugins/bootstrap-select/js/bootstrap-select.js"></script>
<script src="static/plugins/layer/layer.js"></script>
<script src="static/plugins/laydate/laydate.js"></script>
<script src="static/plugins/webix/codebase/webix.js?v=6.0.7"></script>
<script src="static/plugins/webix/querybuilder/querybuilder.js?v=1"></script>
<script src="static/zmodel/common/js/validate.js?v=1"></script>
<script src="static/plugins/data.js"></script>
<script type="text/javascript">
	var hot1;
	var grid;
	$(document).ready(function() {
		pageSetUp();
		$("#areaCode,#inAreaCode").on("change",function(){
			var tmp = $(this).attr("id");
			if(tmp =='counterAreaCode'){
				$("#counterAreaCode").html("");
			}else{
				$("#inCounterAreaCode").html("");
			}
			$.ajax({
		        type: "POST",
		        url: "sysAreaInfo/getStoreList.do?parentAreaCode="+$(this).val(),
		        dataType: 'json',
		        async: false,
		        success: function(data) {
		            if (data.status == '100') {
		            	var storeList=data.data;
		            	if(tmp == 'areaCode'){
			            	for(var index=0;index<storeList.length;index++){
			            		var store=storeList[index];
				            	$("#counterAreaCode").append("<option value='"+store.areaCode+"'>"+store.areaName+"</option>");
			            	}
				            $("#counterAreaCode").selectpicker('refresh');
		            	}else{
		            		for(var index=0;index<storeList.length;index++){
			            		var store=storeList[index];
				            	$("#inCounterAreaCode").append("<option value='"+store.areaCode+"'>"+store.areaName+"</option>");
			            	}
				            $("#inCounterAreaCode").selectpicker('refresh');
		            	}
		            }else{
		            	layer.msg("获取柜台失败");
		            }
		        },
		        error: function() {
		        	layer.alert("连接服务器失败，请稍后重试");
		        }
		    });
		})
		$("#areaCode").change();
		$("#counterAreaCode").selectpicker('val',"${billTransfer.counterAreaCode}");
		$("#saveAudit").on("click",function(){
			saveBillAudit();
		})
	});
	
	function showDropdown(obj){
		$(obj).parent().find("label").removeClass("active");
		$(obj).addClass('active');
		$(".notification-body").hide();
		$("#"+$(obj).data("id")).show();
	}
	
	function checkBillFlow(){
		var result=false;
		$.ajax({
	        type: "POST",
	        url: "param/checkBillFlow.do",
	        dataType: 'json',
	        data:"module=transfer&areaCode="+$("#areaCode").val(),
	        async: false,
	        success: function(data) {
	            if (data.status == '100') {
	            	result=true;
	            }else{
	            	result=false
	            	var paramList=data.data;
	            	var paramArr=[];
	            	for(var i=0;i<paramList.length;i++){
	            		paramArr.push({view:"checkbox", labelRight:paramList[i].remarks, value:paramList[i].paramValue ,name:paramList[i].paramName})
	            	}
	            	paramArr.push({ view:"button", value: "保存", click:function(){
    					$.ajax({
    				        type: "POST",
    				        url: "param/updateBillFlowParam.do?module=transfer&areaCode="+$("#areaCode").val(),
    				        dataType: 'json',
    				        async: false,
    				        contentType:"application/json",
    				        data:JSON.stringify(this.getParentView().getValues()),
    				        success: function(data) {
    				            if (data.status == '100') {
    				            	$$('win2').close();
    				            	layer.msg("保存成功，请再次保存")
    				            }else{
    				            	layer.msg("获取柜台失败");
    				            }
    				        },
    				        error: function() {
    				        	layer.alert("连接服务器失败，请稍后重试");
    				        }
    				    });
    				}});
	            	var form=webix.ui({
	                    view:"window",
	                    id:"win2",
	                    width:300,
	                    position:"center",
	                    modal:true,
	                    head:{
	    					view:"toolbar", margin:-4, cols:[
	    						{view:"label", label: "尚未设置进货流程，来设置下吧" },
	    						{ view:"icon", icon:"mdi mdi-close", click: function(){
	    							$$('win2').close();
	    						}}
	    					]
	    				},
	                    body:{
	            			view:"form",
	            			borderless:true,
	            			elements: paramArr,
	            			elementsConfig:{
	            				labelPosition:"top",
	            			}
	            		}
	                });
	            	 $$("win2").getBody().clear();
	            	 form.show();
	                 $$("win2").getBody().focus();
	            }
	        },
	        error: function() {
	        	layer.alert("连接服务器失败，请稍后重试");
	        }
	    });
		return result;
	}
	function saveBillAudit(){
		if(!validateForm("billForm")){
			return;
		}else{
			if(checkBillFlow()){
				var billInfo = $("#billForm").serialize();
				billInfo+="&areaName="+$("#areaCode").find(":selected").html();
				billInfo+="&counterAreaName="+$("#counterAreaCode").find(":selected").html()
				$.ajax({
			        type: "POST",
			        url: "purchase/saveBillAudit.do",
			        dataType: 'json',
			        data:billInfo,
			        async: false,
			        success: function(data) {
			            if (data.status == '100') {
			            	layer.msg("保存成功！");
			            }else{
			            	layer.msg(data.msg);
			            }
			        },
			        error: function() {
			        	layer.alert("连接服务器失败，请稍后重试");
			        }
			    });
			};
		}
		
	}
	function reloadData(billInfo){
		if(billInfo){
			$$("itemDatatable").clearAll();
			$$("itemDatatable").parse(billInfo.itemList);
			$("#id").val(billInfo.id);
		}
	}
	function continueEdit(id){
		window.location.href="transfer/editTransferBill.do?id="+id;
	}
	function showQueryBuilder(){
		if($("#areaCode").val() =='' || $("#counterAreaCode").val() ==''){
			layer.msg("请先选择调出门店和柜台");
			return;
		}
		var index = layer.open({
			  type: 2,
			  skin: 'layui-layer-rim', //加上边框
			  area: ['720px', '540px'], //宽高
			  fixed: false, //不固定
			  maxmin: true,
			  content : "common/queryBuilder.do?module=purchase",
			  btn : [ '保存', '取消' ],
			  yes : function(index, layero) {
					var result = $(layero).find("iframe")[0].contentWindow.submitData();
					if (result) {
						var param = $("#billForm").serialize();
						param +="&querySql="+result.code;
						$.ajax({
					        type: "POST",
					        url: "transfer/addTransferItemBatch.do",
					        dataType: 'json',
					        data:encodeURI(param),
					        async: false,
					        success: function(data) {
					        		debugger
					            if (data.status == '100') {
					            	reloadData(data.data);
					            	layer.close(index);
					            }else{
					            	layer.msg("导入符合条件的内容失败");
					            }
					        },
					        error: function() {
					        	layer.alert("连接服务器失败，请稍后重试");
					        }
					    });
					}
				}
			});
	}
	</script>
	<script type="text/javascript" charset="utf-8">
	var context;
	webix.ready(function(){
		webix.i18n.setLocale("zh-CN");
		grid = {
				view:"datatable", 
				id:"itemDatatable",
				select:true,
				height:parent.winHeight-300,
				columns:[
					        {id:"rowNo",header:'#',sort:"int",css:"header",width:50},
					        {id:"id",header:'id',hidden:true},
					        {id:"barcode",sort:"string",header:["条码",{ content:"multiSelectFilter" }] , width:120, css:{ "text-align": "center" },  editor:"text"},
					        {id:"oldBarcode",sort:"string",header:"原条码"},
					        {id:"productName",sort:"string",header:["商品名称",{ content:"multiSelectFilter" }] , width:120, css:{ "text-align": "center" },  editor:"text"},
					        {id:"supplier",sort:"string",header:"供应商名称"},
					        {id:"brandName",sort:"string",header:"品牌名称"},
					        {id:"subName",sort:"string",header:"商品子名称"},
					        {id:"certificateNo",sort:"string",header:"证书号"},
					        {id:"giaCertificateNo",sort:"string",header:"GIA证书号"},
					        {id:"style",sort:"string",header:"款式"},
					        {id:"comStyleNo",sort:"string",header:"公司款号"},
					        {id:"facStyleNo",sort:"string",header:"工厂款号"},
					        {id:"handInch",sort:"string",header:"手寸"},
					        {id:"craft",sort:"string",header:"工艺"},
					        {id:"img",sort:"string",header:"图片路径"},
					        {id:"remarks",sort:"string",header:"商品备注信息"},
					        {id:"bargainName",sort:"string",header:"特价标记"},
					        {id:"outNum",sort:"int",header:"出库数",footer:{ content:"summColumn" }},
					        {id:"outGoldWeight",sort:"int",header:"出库金重",footer:{ content:"summColumn" }},
					        {id:"outMJewelWeight",sort:"int",header:"出库石重",footer:{ content:"summColumn" }},
					        {id:"outCostPrice",sort:"int",header:"出库成本",footer:{ content:"summColumn" }},
					        {id:"outLabelPriceSum",sort:"int",header:"出库标价金额",footer:{ content:"summColumn" }},
					        {id:"outRemarks",sort:"int",header:"出库备注",footer:{ content:"summColumn" }},
					        {id:"num",sort:"int",header:"数量",footer:{ content:"summColumn" }},
					        {id:"netGoldWeight",sort:"int",header:"净金重",footer:{ content:"summColumn" }},
					        {id:"goldLoss",sort:"int",header:"金损"},
					        {id:"goldPurity",sort:"int",header:"金成色"},
					        {id:"goldWeight",sort:"int",header:"金重",footer:{ content:"summColumn" }},
					        {id:"goldPrice",sort:"int",header:"金价"},
					        {id:"goldMoney",sort:"int",header:"金料额",footer:{ content:"summColumn" }},
					        {id:"productWeight",sort:"int",header:"货重",footer:{ content:"summColumn" }},
					        {id:"workFeeKe",sort:"int",header:"克工费"},
					        {id:"workFeeJian",sort:"int",header:"件工费"},
					        {id:"workFeeSum",sort:"int",header:"总工费",footer:{ content:"summColumn" }},
					        {id:"certificateFee",sort:"int",header:"证书费",footer:{ content:"summColumn" }},
					        {id:"fittingName",sort:"string",header:"配件名称"},
					        {id:"fittingNum",sort:"string",header:"配件数",footer:{ content:"summColumn" }},
					        {id:"fittingFee",sort:"int",header:"配件金额",footer:{ content:"summColumn" }},
					        {id:"sandBlastFee",sort:"int",header:"喷砂镶石费",footer:{ content:"summColumn" }},
					        {id:"otherFee",sort:"int",header:"其他费用",footer:{ content:"summColumn" }},
					        {id:"unitPrice",sort:"int",header:"成本单价"},
					        {id:"costPrice",sort:"int",header:"成本金额",footer:{ content:"summColumn" }},
					        {id:"labelWorkFeeKe",sort:"int",header:"标签克工费"},
					        {id:"labelWorkFeeJian",sort:"int",header:"标签件工费"},
					        {id:"labelWorkFeeSum",sort:"int",header:"标签工费",footer:{ content:"summColumn" }},
					        {id:"labelRate",sort:"int",header:"加价率"},
					        {id:"labelPrice",sort:"int",header:"标签价",footer:{ content:"summColumn" }},
					        {id:"labelPriceSum",sort:"int",header:"标价金额",footer:{ content:"summColumn" }},
					        {id:"labelRemarks",sort:"string",header:"标签备注"},
					        {id:"sysCode",sort:"string",header:"商品编码"},
					        {id:"goldName",sort:"string",header:"金料名"},
					        {id:"jewelName",sort:"string",header:"石头"},
					        {id:"categoryName",sort:"string",header:"品名"},
					        {id:"firstType",sort:"string",header:"大类名称"},
					        {id:"secondType",sort:"string",header:"中类"},
					        {id:"productClassify",sort:"string",header:"实际分类"},
					        {id:"firstClassify",sort:"string",header:"商品分组"},
					        {id:"secondClassify",sort:"string",header:"统计分类2"},
					        {id:"labelName",sort:"string",header:"标签显示名称"},
					        {id:"grfName",sort:"string",header:"模板名称"},
					        {id:"thirdClassify",sort:"string",header:"统计分类3"},
					        {id:"mJewelCut",sort:"string",header:"切工"},
					        {id:"mJewelColor",sort:"string",header:"颜色"},
					        {id:"mJewelClarity",sort:"string",header:"净度"},
					        {id:"mJewelFluorescent",sort:"string",header:"荧光"},
					        {id:"mJewelBurnished",sort:"string",header:"抛光度"},
					        {id:"mJewelShape",sort:"string",header:"形状"},
					        {id:"mJewelName",sort:"string",header:"主石名"},
					        {id:"mJewelNo",sort:"string",header:"主石石号"},
					        {id:"mJewelSpecifi",sort:"string",header:"主石规格"},
					        {id:"mJewelNum",sort:"int",header:"主石数",footer:{ content:"summColumn" }},
					        {id:"mJewelWeight",sort:"int",header:"主石重",footer:{ content:"summColumn" }},
					        {id:"mJewelPrice",sort:"int",header:"主石价"},
					        {id:"mJewelFee",sort:"int",header:"主石额",footer:{ content:"summColumn" }},
					        {id:"sJewel1Name",sort:"string",header:"副石1名"},
					        {id:"sJewel1No",sort:"string",header:"副石1石号"},
					        {id:"sJewel1Specifi",sort:"string",header:"副石1规格"},
					        {id:"sJewel1Num",sort:"int",header:"副石1数",footer:{ content:"summColumn" }},
					        {id:"sJewel1Weight",sort:"int",header:"副石1重",footer:{ content:"summColumn" }},
					        {id:"sJewel1Price",sort:"int",header:"副石1价"},
					        {id:"sJewel1Fee",sort:"int",header:"副石1额",footer:{ content:"summColumn" }},
					        {id:"sJewel2Name",sort:"string",header:"副石2名"},
					        {id:"sJewel2No",sort:"string",header:"副石2石号"},
					        {id:"sJewel2Specifi",sort:"string",header:"副石2规格"},
					        {id:"sJewel2Num",sort:"int",header:"副石2数",footer:{ content:"summColumn" }},
					        {id:"sJewel2Weight",sort:"int",header:"副石2重",footer:{ content:"summColumn" }},
					        {id:"sJewel2Price",sort:"int",header:"副石2价"},
					        {id:"sJewel2Fee",sort:"int",header:"副石2额",footer:{ content:"summColumn" }},
					        {id:"sJewel3Name",sort:"string",header:"副石3名"},
					        {id:"sJewel3No",sort:"string",header:"副石3石号"},
					        {id:"sJewel3Specifi",sort:"string",header:"副石3规格"},
					        {id:"sJewel3Num",sort:"int",header:"副石3数",footer:{ content:"summColumn" }},
					        {id:"sJewel3Weight",sort:"int",header:"副石3重",footer:{ content:"summColumn" }},
					        {id:"sJewel3Price",sort:"int",header:"副石3价"},
					        {id:"sJewel3Fee",sort:"int",header:"副石3额",footer:{ content:"summColumn" }},
					        {id:"sJewel4Name",sort:"string",header:"副石4名"},
					        {id:"sJewel4No",sort:"string",header:"副石4石号"},
					        {id:"sJewel4Specifi",sort:"string",header:"副石4规格"},
					        {id:"sJewel4Num",sort:"int",header:"副石4数",footer:{ content:"summColumn" }},
					        {id:"sJewel4Weight",sort:"int",header:"副石4重",footer:{ content:"summColumn" }},
					        {id:"sJewel4Price",sort:"int",header:"副石4价"},
					        {id:"sJewel4Fee",sort:"int",header:"副石4额",footer:{ content:"summColumn" }},
					        {id:"sJewel5Name",sort:"string",header:"副石5名"},
					        {id:"sJewel5No",sort:"string",header:"副石5石号"},
					        {id:"sJewel5Specifi",sort:"string",header:"副石5规格"},
					        {id:"sJewel5Num",sort:"int",header:"副石5数",footer:{ content:"summColumn" }},
					        {id:"sJewel5Weight",sort:"int",header:"副石5重",footer:{ content:"summColumn" }},
					        {id:"sJewel5Price",sort:"int",header:"副石5价"},
					        {id:"sJewel5Fee",sort:"int",header:"副石5额",footer:{ content:"summColumn" }},
					        {id:"priceRange",sort:"string",header:"价格区间"},
					        {id:"goldRange",sort:"string",header:"金重区间"},
					        {id:"costRange",sort:"string",header:"成本区间"},
					        {id:"colorRange",sort:"string",header:"颜色区间"},
					        {id:"clarityRange",sort:"string",header:"净度区间"}
		             	],
				data: ${itemListData}
			};

			var form = {
				view:"form", 
				id:"form1", 
				scroll:true,
				width:250,
				minHeight:200,
				elements:[
					{ view:"text", name:"productName", label:"商品名称",readonly:true },
					{ view:"text", name:"barcode", label:"条码" ,readonly:true},
					{ view:"text", name:"oldBarcode", label:"原条码号" ,readonly:true,},
					{ view:"counter", name:"outNum",required:true, label:"调出数量"},
					{ view:"text", name:"outGoldWeight", label:"调出金重",format:"1111.00"},
					{ view:"text", name:"outMJewelWeight",label:"调出石重",format:"1111.00"},
					{ view:"text", name:"outRemarks", label:"调拨备注"},
					{ view:"button", value:"保存", type:"form", click:function(){
						if (this.getFormView().validate()){
							$$("form1").save();
						}else{
							webix.message({ type:"error", text:"输入错误，请重新输入" });
						}
					}}
				],
				rules:{
					$obj:function(){
						var data = this.getValues();

						if (!webix.rules.isEmail( data.outNum )) {
							return false;	
						}
						if (data.outGoldWeight == ""){
							return false;
						} 
						return true;
					}
 				 },
 				elementsConfig:{
 					labelPosition:"right",
 					labelAlign:'right',
 					labelWidth:75,
 					marginBottom:1
 				}
			};

			webix.ui({ 
				container:"testA",
				rows:[{cols:[{body:grid}, 
				             {view:"resizer"},
				             {header:"修改调出信息",body:form}
					 ]}
				]
			});
			$$('form1').bind('itemDatatable')
	});
	</script>
</html>