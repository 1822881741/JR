<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"> 
<#include "/header-smart.html" />
<base href="${basePath}">
<link rel="stylesheet" href="static/plugins/webix/codebase/webix.css?v=6.0.7" type="text/css" charset="utf-8">
<!--link rel="stylesheet" type="text/css" href="static/plugins/webix/codebase/skins/mini.min.css"-->
<style>
    .myhover{
        background: #F4F5F9;
    }
     .header{
            background-color: #edf7fe;
        }
</style>
<body>
	<section id="widget-grid">
		<!-- row -->
		<div class="row no-margin">
			<article class="col-sm-12 col-md-12 col-lg-12">
				<div class="jarviswidget no-margin-bottom" id="wid-id-5"
					data-widget-colorbutton="false" data-widget-editbutton="false"
					data-widget-togglebutton="false" data-widget-deletebutton="false"
					data-widget-fullscreenbutton="false"
					data-widget-custombutton="false" data-widget-sortable="false">
					<div>
						<div class="widget-body">
							<div class="row">
								<div class="row margin-left-10">
									<div class="col-sm-6 col-md-6 col-lg-6">
										<ul class="demo-btns">
											<li><a href="javascript:void(0);" class="btn btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 新增</a></li>
											<li><a id="saveAudit" href="javascript:void(0);" class="btn btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 保存</a></li>
											<li><a href="javascript:void(0);" id="activity" class="activity-dropdown btn  btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 未完成 <em class="badge bg-color-red">23</em></a>
												<div class="ajax-dropdown">
													<div class="btn-group btn-group-justified" >
														<label class="btn btn-default" data-id='noSave' onclick="alert(3)">未完成(5)</label>
														<label class="btn btn-default" data-id='waitAudit' onclick="showDropdown(this)">待审核 (3)</label>
														<label class="btn btn-default" data-id='onWay' onclick="showDropdown(this)">在途 (4)</label>
													</div>
													<div class="ajax-notifications custom-scroll">
														<div class="alert alert-transparent no-margin no-padding">
															<ul id='noSave' class="notification-body">
																<li>
																	<span class=" unread">
																		<em class="badge padding-5 no-border-radius bg-color-blueLight pull-left margin-right-5">
																			<i class="fa fa-user fa-fw fa-2x"></i>
																		</em>
																		<span>
																			 2 new users2222 just signed up! <span class="text-primary">martin.luther</span> and <span class="text-primary">kevin.reliey</span>
																			 <br>
																			 <span class="pull-right font-xs text-muted"><i>1 min ago...</i></span>
																		</span>
																	</span>
																</li>
															</ul>
															<ul id='waitAudit' class="notification-body">
																<li>
																	<span class=" unread">
																		<em class="badge padding-5 no-border-radius bg-color-blueLight pull-left margin-right-5">
																			<i class="fa fa-user fa-fw fa-2x"></i>
																		</em>
																		<span>
																			 2 new users just signed up! <span class="text-primary">martin.luther</span> and <span class="text-primary">kevin.reliey</span>
																			 <br>
																			 <span class="pull-right font-xs text-muted"><i>1 min ago...</i></span>
																		</span>
																	</span>
																</li>
															</ul>
															<ul id='onWay' class="notification-body">
																<li>
																	<span class=" unread">
																		<em class="badge padding-5 no-border-radius bg-color-blueLight pull-left margin-right-5">
																			<i class="fa fa-user fa-fw fa-2x"></i>
																		</em>
																		<span>
																			 2 new users just signed up! <span class="text-primary">martin.luther</span> and <span class="text-primary">kevin.reliey</span>
																			 <br>
																			 <span class="pull-right font-xs text-muted"><i>1 min ago...</i></span>
																		</span>
																	</span>
																</li>
															</ul>																														
														</div>
													</div>
												</div>
											</li>
											<li><a href="javascript:void(0);" class="btn btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 打印</a></li>
											<li><a href="javascript:void(0);" class="btn btn-sm btn-default"><i class="fa fa-gear fa-lg"></i> 预览</a></li>
										</ul>
									</div>
									<div class="col-sm-6 col-md-6 col-lg-6">
										<a class="btn btn-sm btn-default"  href="javascript:void(0);" style="margin-left: 160px;" onclick="viewImportBill()"><i class="fa fa-gear fa-lg"></i> 导入</a>
										<a class="btn btn-sm btn-default"  href="javascript:void(0);" style="margin-left: 160px;" onclick="editScheme('')"><i class="fa fa-gear fa-lg"></i> 新增</a>
									</div>
								</div>
								
								<hr class="simple margin-5">
								<form id="billForm" class="form-horizontal" role="form">
									<input type="hidden" id="id" name="id">
									<div class="row margin-bottom-5">
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
					 					   <label class="col-md-4 col-sm-6 control-label">供应商</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="supplier" name="supplier" data-validate="required" class="form-control selectpicker show-tick" data-live-search="true">
													<#list supplierList as p>
														<option value='${p}'>${p}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">进货类型</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="purchaseType" name="purchaseType" data-validate="required" class="form-control selectpicker show-tick" data-live-search="true">
													<#list purchaseTypeList as p>
														<option value='${p}'>${p}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">进货门店</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="areaCode" name="areaCode" data-validate="required" class="form-control selectpicker show-tick" title="请选择门店/部门" data-live-search="true">
													<#list areaList as p>
														<option value='${p.areaCode}' <#if p.areaType == 0>data-icon="fa fa-bank" data-subtext="总公司"</#if> <#if p.areaType == 1>data-icon="fa fa-cubes" data-subtext="区域"</#if> <#if p.areaType == 2>data-icon="fa fa-cab" data-subtext="门店"</#if> >${p.areaName}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">进货柜台</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="counterAreaCode" name="counterAreaCode" data-validate="required" class="form-control selectpicker show-tick" title="请选择柜台" data-live-search="true">
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">进货日期</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" class="form-control input-sm"  data-validate="required" id="billDate" name="billDate" value="${billPurchase.billDate}">
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">单号</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" class="form-control" id="billNo" name="billNo"  data-validate="required"  value="${billPurchase.billNo}" placeholder="请输入名字">
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">品牌</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="brandName" name="brandName"  data-validate="required" class="form-control selectpicker show-tick" data-live-search="true">
													<#list brandNameList as p>
														<option value='${p}'>${p}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">备注</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" id="remarks" name="remarks" class="form-control"  placeholder="请输入名字" value="${billPurchase.remarks}" >
											</div>
										</div>
									</div>
								</form>
							</div>
							<div id="testA"></div>
						</div>
					</div>
				</div>
			</article>
		</div>
	</section>
</body>
<script src="static/js/libs/jquery-3.2.1.min.js"></script>
<script src="static/js/app.config.js"></script>
<script src="static/js/bootstrap/bootstrap.min.js"></script>
<script src="static/js/smartwidgets/jarvis.widget.min.js"></script>
<script src="static/js/app.js?v=2"></script>
<script src="static/plugins/bootstrap-select/js/bootstrap-select.js"></script>
<script src="static/plugins/bootstrap-select/js/i18n/defaults-zh_CN.min.js"></script>
<script src="static/plugins/layer/layer.js"></script>
<script src="static/plugins/laydate/laydate.js"></script>
<script src="static/plugins/webix/codebase/webix.js?v=6.0.7"></script>
<script src="static/zmodel/common/js/validate.js?v=1"></script>
<script src="static/plugins/data.js?v=42"></script>
<script type="text/javascript">
	var hot1;
	var grid;
	$(document).ready(function() {
		pageSetUp();
		
		$("#canUseBtn").on("click",function(){
			$(this).parent().find("label").removeClass("active");
			$(this).addClass('active');
			$("#canUseSechemeUL").show();
			$("#noUseSechemeUL").hide();
		})
		$("#noUseBtn").on("click",function(){
			$(this).parent().find("label").removeClass("active");
			$(this).addClass('active');
			$("#canUseSechemeUL").hide();
			$("#noUseSechemeUL").show();
		})
		
		$("#areaCode").on("change",function(){
			$("#counterAreaCode").html("");
			$.ajax({
		        type: "POST",
		        url: "sysAreaInfo/getStoreList.do?parentAreaCode="+$(this).val(),
		        dataType: 'json',
		        async: false,
		        success: function(data) {
		            if (data.status == '100') {
		            	var storeList=data.data;
		            	for(var index=0;index<storeList.length;index++){
		            		var store=storeList[index];
			            	$("#counterAreaCode").append("<option value='"+store.areaCode+"'>"+store.areaName+"</option>");
			            	$("#counterAreaCode").selectpicker('refresh');
		            	}
		            }else{
		            	layer.msg("获取柜台失败");
		            }
		        },
		        error: function() {
		        	layer.alert("连接服务器失败，请稍后重试");
		        }
		    });
		})
		laydate.render({
			  elem: '#sheetDate' //指定元素
		});
		
		$("#saveAudit").on("click",function(){
			saveBillAudit();
		})
	});
	
	function showDropdown(obj){
		alert(3)
		$(obj).parent.find("label").removeClass("active");
		$(obj).addClass('active');
		$(".notification-body").hide();
		$("#"+$(obj).attr("id")).show();
	}
	
	function checkBillFlow(){
		var result=false;
		$.ajax({
	        type: "POST",
	        url: "param/checkBillFlow.do",
	        dataType: 'json',
	        data:"module=purchase&areaCode="+$("#deptAreaCode").val(),
	        async: false,
	        success: function(data) {
	            if (data.status == '100') {
	            	result=true;
	            }else{
	            	result=false
	            	var paramList=data.data;
	            	var paramArr=[];
	            	for(var i=0;i<paramList.length;i++){
	            		paramArr.push({view:"checkbox", labelRight:paramList[i].remarks, value:paramList[i].paramValue ,name:paramList[i].paramName})
	            	}
	            	paramArr.push({ view:"button", value: "保存", click:function(){
    					$.ajax({
    				        type: "POST",
    				        url: "param/updateBillFlowParam.do?module=purchase&areaCode="+$("#deptAreaCode").val(),
    				        dataType: 'json',
    				        async: false,
    				        contentType:"application/json",
    				        data:JSON.stringify(this.getParentView().getValues()),
    				        success: function(data) {
    				            if (data.status == '100') {
    				            	$$('win2').close();
    				            	layer.msg("保存成功，请再次保存")
    				            }else{
    				            	layer.msg("获取柜台失败");
    				            }
    				        },
    				        error: function() {
    				        	layer.alert("连接服务器失败，请稍后重试");
    				        }
    				    });
    				}});
	            	var form=webix.ui({
	                    view:"window",
	                    id:"win2",
	                    width:300,
	                    position:"center",
	                    modal:true,
	                    head:{
	    					view:"toolbar", margin:-4, cols:[
	    						{view:"label", label: "尚未设置进货流程，来设置下吧" },
	    						{ view:"icon", icon:"mdi mdi-close", click: function(){
	    							$$('win2').close();
	    						}}
	    					]
	    				},
	                    body:{
	            			view:"form",
	            			borderless:true,
	            			elements: paramArr,
	            			elementsConfig:{
	            				labelPosition:"top",
	            			}
	            		}
	                });
	            	 $$("win2").getBody().clear();
	            	 form.show();
	                 $$("win2").getBody().focus();
	            }
	        },
	        error: function() {
	        	layer.alert("连接服务器失败，请稍后重试");
	        }
	    });
		return result;
	}
	function saveBillAudit(){
		if(!validateForm("billForm")){
			return;
		}else{
			if(checkBillFlow()){
				var billInfo = $("#billForm").serialize();
				$.ajax({
			        type: "POST",
			        url: "purchase/saveBillAudit.do",
			        dataType: 'json',
			        data:billInfo,
			        async: false,
			        success: function(data) {
			            if (data.status == '100') {
			            	var storeList=data.data;
			            	for(var index=0;index<storeList.length;index++){
			            		var store=storeList[index];
				            	$("#storeAreaCode").append("<option value='"+store.areaCode+"'>"+store.areaName+"</option>");
				            	$("#storeAreaCode").selectpicker('refresh');
			            	}
			            }else{
			            	layer.msg("获取柜台失败");
			            }
			        },
			        error: function() {
			        	layer.alert("连接服务器失败，请稍后重试");
			        }
			    });
			};
		}
		
	}
	
	function editScheme(id) {
		layer.open({
			type : 2,
			title : "新增/修改商品分类",
			area : [ '800px', '620px' ],
			shade : 0.8,
			scrollbar : false,
			id : 'lay_addClassify', //设定一个id，防止重复弹出
			btn : [ '保存', '取消' ],
			moveType : 1, //拖拽模式，0或者1
			content : "purchaseSecheme/editSecheme.do?sechemeId=" + id,
			yes : function(index, layero) {
				var result = $(layero).find("iframe")[0].contentWindow.submitData();
				if (result) {
					
				}
			}
		});
	}
	function viewImportBill(id){
		var index = layer.open({
			type : 2,
			title : "新增/修改商品分类",
			area : [ '700px', '620px' ],
			shade : 0.8,
			scrollbar : false,
			id : 'lay_addClassify', //设定一个id，防止重复弹出
			btn : false,
			moveType : 1, //拖拽模式，0或者1
			maxmin: true,
			content : "purchase/viewImportBill.do?sechemeId=" + id,
			yes : function(index, layero) {
				var result = $(layero).find("iframe")[0].contentWindow.submitData();
				if (result) {
				}
			}
		});
		layer.full(index);
	}
	
	function reloadData(billInfo){
		if(billInfo){
			grid.clearAll();
			grid.parse(billInfo.itemList);
			$("#id").val(billInfo.id);
		}
	}
	function operationRender(instance, td,row){
		return td;
	}
</script>
	<script type="text/javascript" charset="utf-8">
	var context;
	webix.ready(function(){
		grid = webix.ui({
			container:"testA",
			view:"datatable", 
			id:"list1",
			css:"webix_header_border webix_footer_border",
			leftSplit:1,
			headermenu:true,
			columns:[
			        {"id":"index",header:'#',sort:"int",css:"header",width:50,readonly:true},
			        {"id":"id",header:"id",footer:{text:"Total:"}},
					{"id":"goodsClassify",header:"实际分类",footer:{text:"Total:"}},
					{"id":"barcode","header":"原条码",sort:"string"},
             		{"id":"goldWeight","header":"金重",sort:"string",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"num","header":"数量",footer:{ content:"summColumn" },sort:"int",footer:{ content:"summColumn"}, fillspace:4},
             		{"id":"goodsName",header:["商品名称"],sort:"string",footer:{ content:"summColumn" }},
             		{"id":"unitPrice","header":"单价",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subGoodsName","header":"子名称",sort:"string"},
             		{"id":"costPrice","header":"成本金额",sort:"string"},
             		{"id":"markupRate","header":"加价率",sort:"string"},
             		{"id":"salePriceAmount","header":"标价金额",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"labelPrice","header":"标价",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"certificateNo","header":"证书号",sort:"string"},
             		{"id":"archivesNo","header":"商品代码",sort:"string"},
             		{"id":"giaCertificateNo","header":"GIA证书号",sort:"string"},
             		{"id":"styleNo","header":"款号",sort:"string"},
             		{"id":"specialOffersFlag","header":"特价标识",sort:"string"},
             		{"id":"goldPrice","header":"金价",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"totalGoldWeight","header":"总金重",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"netGoldWeight","header":"净金重",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"worksFee4Ke","header":"工费/克"},
             		{"id":"worksFee4Jian","header":"工费/件"},
             		{"id":"worksFee4Total","header":"工费总额",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"certificateFee","header":"证书费",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"otherFee","header":"其他费用",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"fittingsFee","header":"配件金额",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"oldMaterialLoss","header":"旧料损耗","format":"0.000"},
             		{"id":"sandBlastFee","header":"喷砂镶石",sort:"string"},
             		{"id":"goodsWeight","header":"商品总重",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"archivesCategory","header":"品类",sort:"string"},
             		{"id":"mainType","header":"核算分类",sort:"string"},
             		{"id":"shortCut","header":"手寸",sort:"string"},
             		{"id":"mainStoneClarity","header":"净度",sort:"string"},
             		{"id":"mainStoneColor","header":"颜色",sort:"string"},
             		{"id":"mainStoneCut","header":"切工",sort:"string"},
             		{"id":"mainStoneFluorescent","header":"荧光",sort:"string"},
             		{"id":"mainStoneSymmetry","header":"对称性",sort:"string"},
             		{"id":"mainStoneBurnished","header":"抛光",sort:"string"},
             		{"id":"peiShiCostPrice","header":"配石成本",sort:"string"},
             		{"id":"peiShiRate","header":"配石倍率",sort:"int"},
             		{"id":"peiShiLabelPrice","header":"配石标价",sort:"int"},
             		{"id":"mainStoneName","header":"主石名称",sort:"string"},
             		{"id":"mainStoneNo","header":"主石号",sort:"string"},
             		{"id":"mainStoneWeight","header":"主石重",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"mainStoneNum","header":"主石粒数",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"mainStonePrice","header":"主石价",sort:"int"},
             		{"id":"mainStoneMoney","header":"主石金额",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone1Name","header":"副石名称",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone1No","header":"副石号",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone1Weight","header":"副石重",sort:"string"},
             		{"id":"subStone1Num","header":"副石粒数",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone1Price","header":"副石价",sort:"int"},
             		{"id":"subStone1Money","header":"副石金额",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone2Name","header":"副石2名称",sort:"int"},
             		{"id":"subStone2No","header":"副石2号",sort:"int"},
             		{"id":"subStone2Weight","header":"副石2重",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone2Num","header":"副石2粒数",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone2Price","header":"副石2价",sort:"int"},
             		{"id":"subStone2Money","header":"副石金额2",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone3Name","header":"副石名称3",sort:"int"},
             		{"id":"subStone3No","header":"副石3号",sort:"int"},
             		{"id":"subStone3Weight","header":"副石重3"},
             		{"id":"subStone3Num","header":"副石粒数3",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"subStone3Price","header":"副石价3",sort:"int"},
             		{"id":"subStone3Money","header":"副石金额3",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"labelWorkFee4Ke","header":"标签工费/克",sort:"int"},
             		{"id":"labelWorkFee4Jian","header":"标签工费/件",sort:"int"},
             		{"id":"archivesFineness","header":"成色",sort:"string"},
             		{"id":"archivesStone","header":"石料",sort:"string"},
             		{"id":"measurementMode","header":"计量方式",sort:"string"},
             		{"id":"maoGoldWeight","header":"毛金重",sort:"int",footer:{ content:"summColumn" }},
             		{"id":"goldLoss","header":"损耗",sort:"string"},
             		{"id":"style","header":"款式",sort:"string"},
             		{"id":"craft","header":"工艺",sort:"string"},
             		{"id":"labelRemarks","header":"标签备注",sort:"string"}
             	],
			footer:true,
			clipboard:true,
			footer:true,
			resizeColumn:true,
    		height:parent.winHeight-290,
			dragColumn:true,
			select: "row", 
			multiselect: true, 
			blockselect: true,
			hover:"myhover",
			data:data,
			on:{
			    "onItemClick":function(id, e, trg){
			        //webix.message("Click on row: " + id.row+", column: " + id.column);
			        },
			     "data->onStoreUpdated":function(){
						this.data.each(function(obj, i){
							obj.rowNo = i+1;
						})
					}
				}
		})
		
		 context=webix.ui({
	        view:"contextmenu",
		    id:"cmenu",
	        data:["Add","Rename","Delete",{ $template:"Separator" },"Info"],
	        on:{
	            onItemClick:function(id){
	                var context = this.getContext();
	                var list = context.obj;
	                var listId = context.id;
	                webix.message("List item: <i>"+grid.getItem(listId).goodsName+"</i> <br/>Context menu item: <i>"+this.getItem(id).value+"</i>");
	            }
	        }
	    });
		context.attachTo(grid);
		webix.event(window, "resize", function(){
			grid.define("width", $("#bootstrap-wizard-1").width()-30);
			grid.adjust(); })
		});	
	</script>
</html>