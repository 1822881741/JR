<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"> 
<#include "/header-smart.html" />
<base href="${basePath}">
<link rel="stylesheet" type="text/css" href="static/plugins/handsontable/handsontable.full.min.css?v=21">
<style type="text/css">
</style>
<body>
	<section id="widget-grid">
		<!-- row -->
		<div class="row no-margin">
			<article class="col-sm-12 col-md-12 col-lg-12">
				<div class="jarviswidget" id="wid-id-5"
					data-widget-colorbutton="false" data-widget-editbutton="false"
					data-widget-togglebutton="false" data-widget-deletebutton="false"
					data-widget-fullscreenbutton="false"
					data-widget-custombutton="false" data-widget-sortable="false">
					<div class="widget-body">
						<div class="widget-body-toolbar no-padding-bottom">
							<div class="row margin-left-10">
								<div class="col-sm-4 col-md-4 col-lg-4">
									<ul class="demo-btns">
										<li><a href="javascript:void(0);"
											class="btn btn-sm btn-default"><i
												class="fa fa-gear fa-lg"></i> 新增</a></li>
										<li><a href="javascript:void(0);"
											class="btn btn-sm btn-default"><i
												class="fa fa-gear fa-lg"></i> 打印</a></li>
										<li><a href="javascript:void(0);"
											class="btn btn-sm btn-default"><i
												class="fa fa-gear fa-lg"></i> 预览</a></li>
									</ul>
								</div>
								<div class="col-sm-8 col-md-8 col-lg-8">
									<a id="activity" class="activity-dropdown btn btn-sm btn-default"  href="javascript:void(0);" style="margin-left: 160px;" onclick="viewImportBill()"><i class="fa fa-gear fa-lg"></i> 导入</a>
								</div>
								</div>
							</div> 
							<div class="row margin-left-10">
								<form class="form-horizontal" role="form">
									<div class="row margin-bottom-5">
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">供应商</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="supplier" name="supplier" class="form-control selectpicker show-tick" data-live-search="true">
													<#list supplierList as p>
														<option value='${p}'>${p}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">进货类型</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="purchaseType" name="purchaseType" class="form-control selectpicker show-tick" data-live-search="true">
													<#list purchaseTypeList as p>
														<option value='${p}'>${p}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">进货门店</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="deptAreaCode" name="deptAreaCode" class="form-control selectpicker show-tick" title="请选择门店/部门" data-live-search="true">
													<#list areaList as p>
														<option value='${p.areaCode}' <#if p.areaType == 0>data-icon="fa fa-bank" data-subtext="总公司"</#if> <#if p.areaType == 1>data-icon="fa fa-cubes" data-subtext="区域"</#if> <#if p.areaType == 2>data-icon="fa fa-cab" data-subtext="门店"</#if> >${p.areaName}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">进货柜台</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="storeAreaCode" name="storeAreaCode" class="form-control selectpicker show-tick" title="请选择柜台" data-live-search="true">
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">进货日期</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" class="form-control input-sm" id="sheetDate" name="sheetDate"  onclick="laydate()" >
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">单号</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" class="form-control" id="firstname" placeholder="请输入名字">
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">品牌</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<select id="purchaseType" name="purchaseType" class="form-control selectpicker show-tick" data-live-search="true">
													<#list brandNameList as p>
														<option value='${p}'>${p}</option>
													</#list>
												</select>
											</div>
										</div>
										<div class="form-group col-sm-3 col-md-3 col-lg-3">
											<label class="col-md-4 col-sm-6 control-label">备注</label>
											<div class="col-md-8 col-sm-6 no-padding">
												<input type="text" id="remarks" name="remarks" class="form-control"  placeholder="请输入名字">
											</div>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
				<div class="well">
					<div id='hot' class="hot handsontable htRowHeaders htColumnHeaders" style="overflow: hidden;"></div>
				</div>
			</article>
		</div>
	</section>
</body>
<script src="static/js/libs/jquery-3.2.1.min.js"></script>
<script src="static/js/app.config.js"></script>
<script src="static/js/bootstrap/bootstrap.min.js"></script>
<script src="static/js/smartwidgets/jarvis.widget.min.js"></script>
<script src="static/js/app.js?v=2"></script>
<script src="static/plugins/bootstrap-select/js/bootstrap-select.js"></script>
<script src="static/plugins/bootstrap-select/js/i18n/defaults-zh_CN.min.js"></script>
<script src="static/plugins/handsontable/handsontable.full.js?v=3"></script>
<script src="static/plugins/handsontable/languages/zh-CN.js"></script>
<script src="static/plugins/layer/layer.js"></script>
<script src="static/plugins/laydate/laydate.js"></script>
<script type="text/javascript">
var hot1;
	$(document).ready(function() {
		pageSetUp();
		  var generateDataObj = function(rows, columns) {
		    var data = [];
		    var number = 0;
		  
		    if (!rows) {
		      rows = 3;
		    }
		    if (!columns) {
		      columns = 7;
		    }
		  
		    for (var i = 0; i < rows; i++) {
		      data[i] = [];
		      for (var j = 0; j < columns; j++) {
		        data[i][j] = number++;
		      }
		    }
		  
		    data.push([]);  
		    return data;
		  };
		var example = document.getElementById('hot');
		var data = generateDataObj();
		hot1 = new Handsontable(example, {
			dropdownMenu: true,
			columns:[
		         {"data":'col1',width:300},
		         {"data":"col2",width:300},
		         {"data":"col3",width:300},
		         {"data":"col4",width:300},
		         {"data":"col5",width:300},
		         {"data":"col6",width:300}],
		    filters: true,
		    data: [{col1:'1',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'2',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'3',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:2,col5:3.5,col6:6.7},{col1:'zs',col2:'ls',col3:1,col4:33,col5:3.5,col6:6.7},{}],
		    colHeaders: true,
		    height:300,
		    rowHeaders: true,
		    fixedRowsBottom: 1,
		    columnSorting:{ignoreFixedRows:true},
		    fixedColumnsLeft: 1,
		    columnSummary: data[0].map((d,i) => ({
		        destinationRow: 0,
		        reversedRowCoords: true,
		        destinationColumn: i,
		        type: 'sum',
		        forceNumeric: true
		    })) 
		});
		
		var autoRowSizePlugin = hot1.getPlugin('autoRowSize');
	    var totalRows = hot1.countRows();
	    if (autoRowSizePlugin.getLastVisibleRow() === totalRows - 1) {
	      var totalRowHeight = 0;
	      for (var i = 0; i < hot1.countRows(); i++) {
	        totalRowHeight += autoRowSizePlugin.getRowHeight(i, 24);
	      }
	      document.querySelector("#hot").style.height = totalRowHeight + "px";
	      hot1.updateSettings({
	        height: totalRowHeight + (autoRowSizePlugin.getColumnHeaderHeight() || 24)
	      });
	    }
		
		$("#canUseBtn").on("click",function(){
			$(this).parent().find("label").removeClass("active");
			$(this).addClass('active');
			$("#canUseSechemeUL").show();
			$("#noUseSechemeUL").hide();
		})
		$("#noUseBtn").on("click",function(){
			$(this).parent().find("label").removeClass("active");
			$(this).addClass('active');
			$("#canUseSechemeUL").hide();
			$("#noUseSechemeUL").show();
		})
		
		$("#deptAreaCode").on("change",function(){
			$("#storeAreaCode").html("");
			$.ajax({
		        type: "POST",
		        url: "sysAreaInfo/getStoreList.do?parentAreaCode="+$(this).val(),
		        dataType: 'json',
		        async: false,
		        success: function(data) {
		            if (data.status == '100') {
		            	var storeList=data.data;
		            	for(var index=0;index<storeList.length;index++){
		            		var store=storeList[index];
			            	$("#storeAreaCode").append("<option value='"+store.areaCode+"'>"+store.areaName+"</option>");
			            	$("#storeAreaCode").selectpicker('refresh');
		            	}
		            }else{
		            	layer.msg("获取柜台失败");
		            }
		        },
		        error: function() {
		        	layer.alert("连接服务器失败，请稍后重试");
		        }
		    });
		})
		laydate.render({
			  elem: '#sheetDate' //指定元素
			});
	});
	function editScheme(id) {
		//
		layer.open({
			type : 2,
			title : "新增/修改商品分类",
			area : [ '800px', '620px' ],
			shade : 0.8,
			scrollbar : false,
			id : 'lay_addClassify', //设定一个id，防止重复弹出
			btn : [ '保存', '取消' ],
			moveType : 1, //拖拽模式，0或者1
			content : "purchaseSecheme/editSecheme.do?sechemeId=" + id,
			yes : function(index, layero) {
				var result = $(layero).find("iframe")[0].contentWindow.submitData();
				if (result) {
				}
			}
		});
	}
	function viewImportBill(id){
		var index = layer.open({
			type : 2,
			title : "新增/修改商品分类",
			area : [ '800px', '620px' ],
			shade : 0.8,
			scrollbar : false,
			id : 'lay_addClassify', //设定一个id，防止重复弹出
			btn : false,
			moveType : 1, //拖拽模式，0或者1
			maxmin: true,
			content : "purchase/viewImportBill.do?sechemeId=" + id,
			yes : function(index, layero) {
				var result = $(layero).find("iframe")[0].contentWindow.submitData();
				if (result) {
				}
			}
		});
		layer.full(index);
	}
	
	function reloadData(billId){
		if(billId){
			hot1.loadData(billId);
		}
	}
	function operationRender(instance, td,row){
	
		return td;
	}
</script>
</html>